<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blackjack Online - Vista del Dealer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" href="/css/dealer.css">
</head>

<body>
    <!--* HEADER *-->
    <header class="top-bar">
        <div class="left-group">
            <button class="exit-btn" onclick="exitRoom()">
                <i class="fas fa-door-open"></i> EXIT ROOM
            </button>
            <div class="invite-section">
                <span id="roomCodeText">Código: </span>
                <button id="copyBtn">COPY</button>
            </div>
        </div>
        <div class="dealer-title">DEALER VIEW</div>
        <!--* Botón Hamburguesa *-->
        <button class="menu-toggle" id="menuToggle">
            <i class="fas fa-bars"></i>
        </button>
        <!--* Menú Oculto (en móviles) *-->
        <nav class="mobile-menu" id="mobileMenu">
            <button class="how-to-play">🔊 HOW TO PLAY</button>
            <button class="exit-btn" onclick="window.location.href='../Login/index.html'">EXIT</button>
            <button>COPY INVITE</button>
        </nav>
        <!--* Botón normal en escritorio *-->
        <button class="how-to-play desktop-only">🔊 HOW TO PLAY</button>
    </header>
    <div class="sidebar">
        <div class="online-status">
            <div class="status-icon"></div>
            <span class="user-icon">👥</span>
            <h2 id="contador">0</h2>
        </div>
    </div>
    <!--* ÁREA DE JUEGO PRINCIPAL *-->
    <div class="game-area">
        <!--* ÁREA DE JUGADORES (AHORA ARRIBA) *-->
        <div class="player-area">
            <div class="player-cards" id="playerCards">
                <div class="player-position curve-left">
                    <div class="card card-red">
                        <div class="card-value">K</div>
                        <div class="card-suit">♥</div>
                        <div class="card-value-bottom">K</div>
                    </div>
                    <div class="player-bet">
                        <div class="player-chip chip-100">$100</div>
                        <span class="bet-amount">$100</span>
                    </div>
                </div>
                <div class="player-position curve-center">
                    <div class="card card-black">
                        <div class="card-value">A</div>
                        <div class="card-suit">♠</div>
                        <div class="card-value-bottom">A</div>
                    </div>
                    <div class="player-bet">
                        <div class="player-chip chip-25">$25</div>
                        <span class="bet-amount">$25</span>
                    </div>
                </div>
                <div class="player-position curve-right">
                    <div class="card card-red">
                        <div class="card-value">Q</div>
                        <div class="card-suit">♦</div>
                        <div class="card-value-bottom">Q</div>
                    </div>
                    <div class="player-bet">
                        <div class="player-chip chip-500">$500</div>
                        <span class="bet-amount">$500</span>
                    </div>
                </div>
            </div>
        </div>
        <!--* SVG DECORATIVO (INVERTIDO) *-->
        <div class="svg-container">
            <svg viewBox="0 0 1000 400" style="width: 100%; height: 300px;">
                <defs>
                    <!--* Curvas invertidas - curvándose hacia abajo (sonrisa invertida) *-->
                    <path id="curve-top" d="M 150 150 Q 500 50 850 150" />
                    <path id="curve-bottom" d="M 150 200 Q 500 100 850 200" />
                    <!--* Efectos de sombra *-->
                    <filter id="shadow">
                        <feDropShadow dx="3" dy="3" stdDeviation="3" flood-color="#000" flood-opacity="0.5" />
                    </filter>
                </defs>
                <!--* Línea decorativa visible *-->
                <path d="M 150 250 Q 500 150 850 250" stroke="#D4AF37" stroke-width="4" fill="none"
                    filter="url(#shadow)" />
                <!--* Texto superior *-->
                <text font-family="Times New Roman, serif" font-weight="bold" fill="#D4AF37" font-size="56"
                    text-anchor="middle" filter="url(#shadow)">
                    <textPath href="#curve-top" startOffset="50%">
                        BLACKJACK PAY 3 TO 2
                    </textPath>
                </text>
                <!--* Texto inferior *-->
                <text font-family="Times New Roman, serif" font-weight="bold" fill="#D4AF37" font-size="36"
                    text-anchor="middle" filter="url(#shadow)">
                    <textPath href="#curve-bottom" startOffset="50%">
                        DEALER MUST STAND ON 17 AND DRAW TO 16
                    </textPath>
                </text>
            </svg>
        </div>
        <!--* ÁREA DEL DEALER (AHORA ABAJO) *-->
        <div class="dealer-area">
            <div class="dealer-cards" id="dealerCards">
                <div class="card card-back">
                    <div class="card-value"></div>
                    <div class="card-suit"></div>
                    <div class="card-value-bottom"></div>
                </div>
                <div class="card card-red">
                    <div class="card-value">7</div>
                    <div class="card-suit">♥</div>
                    <div class="card-value-bottom">7</div>
                </div>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
 const socket = io();

        // Escuchar actualizaciones de usuarios conectados
        socket.on('usuariosConectados', (cantidad) => {
            document.getElementById('contador').textContent = cantidad;
        });

        // Menú hamburguesa (si es necesario)
        const menuToggle = document.getElementById('menuToggle');
        const mobileMenu = document.getElementById('mobileMenu');

        if (menuToggle && mobileMenu) {
            menuToggle.addEventListener('click', function() {
                mobileMenu.classList.toggle('active');
            });
        }

        // Se ejecuta cuando el DOM está completamente cargado
        document.addEventListener('DOMContentLoaded', () => {
            // Extraer el código de la mesa desde la URL
            const params = new URLSearchParams(window.location.search);
            const roomCode = params.get('codigo');

            if (roomCode) {
                const roomCodeText = document.getElementById('roomCodeText');
                const copyBtn = document.getElementById('copyBtn');

                // 1. Mostrar el código en la página
                roomCodeText.textContent = `${roomCode}`;

                // 2. Configurar el botón de copiar
                copyBtn.onclick = () => {
                    navigator.clipboard.writeText(roomCode)
                        .then(() => alert('¡Código copiado al portapapeles!'))
                        .catch(err => console.error('Error al copiar:', err));
                };

                // 3. Unir este socket a una "sala" específica en el servidor
                // Esto es clave para arreglar el contador de jugadores.
                socket.emit('joinRoom', roomCode);
            }
        });

        // Función para salir de la sala 
        async function exitRoom() {
            const params = new URLSearchParams(window.location.search);
            const roomCode = params.get('codigo');
            if (confirm('¿Seguro que quieres cerrar la sala? Esto desconectará a todos los jugadores.')) {
                try {
                    await fetch('/salir-mesa', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ codigo: roomCode })
                    });
                    window.location.href = '/';
                } catch (error) {
                    console.error('Error al salir de la mesa:', error);
                    alert('No se pudo salir de la mesa. Inténtalo de nuevo.');
                }
            }
        }

    </script>
</body>

</html>