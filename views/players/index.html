<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" href="/css/players.css">

<body>
    <!-- HEADER -->
    <header class="top-bar">
        <div class="left-group">
            <button class="exit-btn">
                <i class="fas fa-door-open"></i> EXIT ROOM
            </button>
        </div>

        <div class="dealer-title">PLAYER VIEW</div>

        <!-- Botón Hamburguesa -->
        <button class="menu-toggle" id="menuToggle">
            <i class="fas fa-bars"></i>
        </button>

        <!-- Menú Oculto (en móviles) -->
        <nav class="mobile-menu" id="mobileMenu">
            <button class="how-to-play">🔊 HOW TO PLAY</button>
            <button class="exit-btn" onclick="window.location.href='../Login/index.html'">EXIT</button>
            <button>COPY INVITE</button>
        </nav>

        <!-- Botón normal en escritorio -->
        <button class="how-to-play desktop-only">🔊 HOW TO PLAY</button>
    </header>

    <!-- SIDEBAR -->
    <div class="sidebar">
        <div class="online-status">
            <div class="status-icon"></div>
            <span class="user-icon">👥</span>
            <span id="contador">1 online</span>
        </div>
    </div>
    <!-- ÁREA DE JUEGO PRINCIPAL -->
    <div class="game-area">
        <!-- ÁREA DEL DEALER (ARRIBA) -->
        <div class="dealer-area">
            <div class="dealer-cards" id="dealerCards">
                <!-- Primera carta oculta -->
                <div class="card card-back">
                    <div class="card-value"></div>
                    <div class="card-suit"></div>
                    <div class="card-value-bottom"></div>
                </div>
                <!-- Segunda carta visible -->
                <div class="card card-red">
                    <div class="card-value">7</div>
                    <div class="card-suit">♥</div>
                    <div class="card-value-bottom">7</div>
                </div>
            </div>
        </div>

        <!-- SVG DECORATIVO (CENTRO) -->

        <!-- SVG DECORATIVO (CENTRO) -->
        <div class="svg-container">
            <svg viewBox="0 0 1000 400" style="width: 100%; height: 300px;">
                <defs>
                    <!-- Curvas alineadas -->
                    <path id="curve-top" d="M 150 150 Q 500 220 850 150" />
                    <path id="curve-bottom" d="M 150 200 Q 500 270 850 200" />
                  <path id="curve-middle" d="M 130 208 Q 500 278 870 208" />


                    <!-- Efectos de sombra -->
                    <filter id="shadow">
                        <feDropShadow dx="3" dy="3" stdDeviation="3" flood-color="#000" flood-opacity="0.5" />
                    </filter>
                </defs>

                <!-- Línea decorativa visible que sigue la curva del texto -->
                <use href="#curve-middle" stroke="#D4AF37" stroke-width="4" fill="none" filter="url(#shadow)" />

                <!-- Texto superior -->
                <text font-family="Times New Roman, serif" font-weight="bold" fill="#D4AF37" font-size="56"
                    text-anchor="middle" filter="url(#shadow)">
                    <textPath href="#curve-top" startOffset="50%">
                        BLACKJACK PAY 3 TO 2
                    </textPath>
                </text>

                <!-- Texto inferior -->
                <text font-family="Times New Roman, serif" font-weight="bold" fill="#D4AF37" font-size="36"
                    text-anchor="middle" filter="url(#shadow)">
                    <textPath href="#curve-bottom" startOffset="50%">
                        DEALER MUST STAND ON 17 AND DRAW TO 16
                    </textPath>
                </text>
            </svg>
        </div>
        <!-- ÁREA DEL JUGADOR (ABAJO) -->
        <div class="player-area">
            <div class="player-cards" id="playerCards">
                <div class="player-position curve-left">
                    <div class="card card-red">
                        <div class="card-value">K</div>
                        <div class="card-suit">♥</div>
                        <div class="card-value-bottom">K</div>
                    </div>
                    <div class="player-bet">
                        <div class="player-chip chip-100">$100</div>
                        <span class="bet-amount">$100</span>
                    </div>
                </div>
                <div class="player-position curve-center">
                    <div class="card card-black">
                        <div class="card-value">A</div>
                        <div class="card-suit">♠</div>
                        <div class="card-value-bottom">A</div>
                    </div>
                    <div class="player-bet">
                        <div class="player-chip chip-25">$25</div>
                        <span class="bet-amount">$25</span>
                    </div>
                </div>
                <div class="player-position curve-right">
                    <div class="card card-red">
                        <div class="card-value">Q</div>
                        <div class="card-suit">♦</div>
                        <div class="card-value-bottom">Q</div>
                    </div>
                    <div class="player-bet">
                        <div class="player-chip chip-500">$500</div>
                        <span class="bet-amount">$500</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ÁREA DE APUESTAS -->
    <div class="betting-area">
        <div class="balance-info">
            <div>Balance</div>
            <div id="balance">$1000</div>
        </div>
        <div>Total Bet<br><span id="totalBet">$0</span></div>
        <div class="chips">
            <div class="chip chip-10" onclick="placeBet(10)">$10</div>
            <div class="chip chip-25" onclick="placeBet(25)">$25</div>
            <div class="chip chip-50" onclick="placeBet(50)">$50</div>
            <div class="chip chip-100" onclick="placeBet(100)">$100</div>
            <div class="chip chip-500" onclick="placeBet(500)">$500</div>
            <div class="chip chip-1000" onclick="placeBet(1000)">$1K</div>
            <div class="chip chip-5000" onclick="placeBet(5000)">$5K</div>
            <div class="chip chip-10000" onclick="placeBet(10000)">$10K</div>
        </div>
        <button onclick="clearBet()">CLEAR</button>
        <button onclick="maxBet()">MAX</button>
    </div>

    <!-- BOTÓN SALIR -->
    <button class="leave-table">🚪 LEAVE TABLE</button>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const params = new URLSearchParams(window.location.search);
        const roomCode = params.get('codigo');

        // Unirse a la sala de socket.io al cargar la página
        if (roomCode) {
            socket.emit('joinRoom', roomCode);
        }

        // Escuchar actualizaciones del contador de usuarios
        socket.on('usuariosConectados', (cantidad) => {
            const contadorEl = document.getElementById('contador');
            if (contadorEl) {
                contadorEl.textContent = `${cantidad} online`;
            }
        });

        // Función para salir de la mesa y notificar al servidor
        async function leaveRoom() {
            if (roomCode && confirm('¿Seguro que quieres salir de la mesa?')) {
                try {
                    // Notificar al servidor que el jugador se va
                    await fetch('/salir-mesa', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ codigo: roomCode })
                    });
                } catch (error) {
                    console.error('Error al notificar la salida de la mesa:', error);
                } finally {
                    window.location.href = '/'; // Redirigir a la página de inicio
                }
            }
        }

        // Asignar la función a los botones de salir
        document.querySelector('.exit-btn').onclick = leaveRoom;
        document.querySelector('.leave-table').onclick = leaveRoom;
    </script>
</body>

</html> 